{% extends "base.html" %}
{% block title %}{{ g.t['modify_game'] if modify else g.t['create_new_game'] }}{% endblock %}

{% block content %}
<div class="container mt-5">
    <h1 class="mb-4" style="font-size:1.2rem;">{{ g.t['modify_game'] if modify else g.t['create_new_game'] }}</h1>
    <form method="post" action="{{ url_for('modify_game', game_id=game_id) if modify else '/create_game' }}">
        <div class="mb-3">
            <label for="team" class="form-label">{{ g.t['category'] }}</label>
            <input type="text" class="form-control" id="team" name="team" required
                value="{{ game.team if modify and game.team is defined else '' }}">
        </div>
        <div class="mb-3">
            <label for="home_team" class="form-label">{{ g.t['home_team'] }}</label>
            <input type="text" class="form-control" id="home_team" name="home_team" required
                value="{{ game.home_team if modify else '' }}">
        </div>
        <div class="mb-3">
            <label for="away_team" class="form-label">{{ g.t['away_team'] }}</label>
            <input type="text" class="form-control" id="away_team" name="away_team" required
                value="{{ game.away_team if modify else '' }}">
        </div>
        <div class="mb-3">
            <label for="date" class="form-label">{{ g.t['date'] }}</label>
            <input type="date" class="form-control" id="date" name="date" required
                value="{{ game.date if modify and game.date is defined else '' }}">
        </div>
        {% for line in range(1, 5) %}
        <div class="mb-3">
            <label class="form-label">{{ g.t['line_players'].replace('{n}', line|string) }}</label>
            <input type="text" class="form-control" name="line{{ line }}"
                placeholder="Player1, Player2, Player3, Player4, ..."
                value="{{ game.lines[line-1]|join(', ') if modify and game.lines|length >= line else '' }}">
        </div>
        {% endfor %}
        {% for goalie in range(1, 3) %}
        <div class="mb-3">
            <label class="form-label">{{ g.t['goalie_name'].replace('{n}', goalie|string) }}</label>
            <input type="text" class="form-control" name="goalie{{ goalie }}" placeholder="Goalie Name"
                value="{{ game.goalies[goalie-1] if modify and game.goalies|length >= goalie else '' }}">
        </div>
        {% endfor %}
        <div class="mb-3">
            <div class="form-check">
                <input type="checkbox" class="form-check-input" id="enable_opponent_goalie"
                    name="enable_opponent_goalie" {{ 'checked' if modify and game.opponent_goalie_enabled else '' }}>
                <label class="form-check-label" for="enable_opponent_goalie">{{ g.t['track_opponent_goalie'] }}</label>
            </div>
        </div>

        <div class="d-flex justify-content-between align-items-center">
            <div>
                <button type="submit" class="btn btn-primary btn-sm">{{ g.t['save_changes'] if modify else g.t['save']
                    }}</button>
                <a href="/" class="btn btn-secondary btn-sm ms-2">{{ g.t['cancel'] }}</a>
            </div>
        </div>
    </form>
    {% if modify %}
    <form id="delete-game-form" method="post" action="/delete_game/{{ game_id }}" class="mt-3">
        <button type="submit" class="btn btn-danger btn-sm">{{ g.t['delete_game'] }}</button>
    </form>
    {% endif %}
</div>
{% endblock %}

{% block scripts %}
<script>
    document.addEventListener('DOMContentLoaded', function () {
        var delForm = document.getElementById('delete-game-form');
        if (delForm) {
            delForm.addEventListener('submit', function (e) {
                if (!confirm("{{ g.t['delete_confirm'] }}")) {
                    e.preventDefault();
                }
            });
        }
    });
</script>
{% endblock %}